# 第三课：提示工程

在本章中，你将学习：

- 什么是提示工程以及了解基础知识如何帮助你获得更好的结果。
- 不同的提示工程技术以及它们如何在不同场景下提供更好的结果。
- 什么是元提示（meta prompts）以及它们如何帮助限制输出、确保可访问性并提供更好的用户体验。

## 环境设置

如果你还没有设置开发环境，以下是设置方法：[设置你的环境](/docs/setup/README.md)。

## 相关资源

[![观看关于提示工程的短视频](https://img.youtube.com/vi/gQ6TlyxBmWs/0.jpg)](https://www.youtube.com/watch?v=gQ6TlyxBmWs&list=PLlrxD0HtieHi5ZpsHULPLxm839IrhmeDk&index=3)

_这个视频介绍了如何提高你的"提示"技巧，教你如何向 AI 提供更清晰、更有效的指令，以获得更好的结果。_

*🎥 点击上方图片观看关于提示工程的短视频*

💼 幻灯片：[提示工程](../../../videos/slides/02-prompt-engineering.pptx)

## 故事叙述：乘车票

> [!NOTE] 
> 到目前为止，你已经与莱昂纳多·达·芬奇一起穿越时空，探索文艺复兴时期的奇迹。你遇到了时间甲虫，这是一个神秘的装置，允许你穿越时间和空间。
>
> 如果你想从头开始了解这个故事，请查看[第一课](../../01-intro-to-genai/README.md)。

> [!NOTE] 
> 虽然我们建议你跟随故事（这很有趣！），但如果你更喜欢直接跳到技术内容，[点击这里](#与斯福尔扎互动)。

**你**：让我看看能否设法回到家。

在你按下按钮之前，工作坊的门突然猛烈撞开，发出雷鸣般的巨响。一个人站在门口，宽肩膀，穿着昂贵的衣服，他在空中挥舞着一张纸，大喊：

<div>
  <img src="../assets/ludovico.png" alt="愤怒的卢多维科·斯福尔扎冲破门而入" width="300">
</div>

*卢多维科·斯福尔扎（Ludovico Sforza）*

**斯福尔扎**：Da Vinci, dov'è il mio dipinto? 我的画在哪里？

**莱昂纳多**：是斯福尔扎。他想让我完成一幅画，"最后的晚餐"。

**你**：你就不能直接告诉他吗？

**莱昂纳多**：我试过了，但他不是一个有耐心的人。

你追着莱昂纳多冲出后门，进入一条黑暗的小巷，你发现一辆马车在等待。

莱昂纳多抓住缰绳，你们俩跳进马车。随着一声响亮的鞭打声，马开始奔跑，穿过佛罗伦萨狭窄的街道。

**莱昂纳多**：试着按下那个小装置，他们越来越近了！

**你**："好的，时间甲虫，仔细听着。我需要回到现在，回家，好吗？"突然，马车碰到了一个颠簸，时间甲虫从你手中飞出，落在地板上。它开始发出哔哔声，并用机器人的声音宣布："前往罗马。"

**你**：不，不是罗马，是家...家...

一团色彩的旋涡笼罩着马车，周围的世界溶解成了一个万花筒般的光芒。

## 逃脱

色彩的旋涡褪去，你发现自己在马车里，现在正沿着罗马的阿皮亚大道（Via Appia）飞驰，令你惊讶的是，你正处于一场赛马比赛的中间。战车轰隆作响地驶过，车轮卷起阵阵尘土。

<div>
  <img src="../assets/escape.png" alt="从罗马逃脱" width="300">
</div>

**你**：莱昂纳多，我们在哪里？

**莱昂纳多**：看起来我们正在一场比赛中！我们需要离开这里！

当马车在混乱中疾驰时，你紧握着车身两侧。骑马的罗马士兵正在逼近，他们的盔甲在阳光下闪闪发光。

**你**：那里！向港口前进！

莱昂纳多将马车转向出口，车轮在鹅卵石上打滑。士兵们紧追不舍，他们的喊叫声在你耳边回荡。

**莱昂纳多**：我们需要甩掉他们！找个地方藏起来！

你扫视着狭窄的街道，心跳加速。

**你**：那里！一条后巷！

莱昂纳多将马车拐进小巷，马车在转弯时剧烈摇晃。你跳下马车，帮助莱昂纳多从车后拖出一个巨大的装置。那是他的发明——空中螺旋桨（aerial screw）。

**莱昂纳多**：快，我们需要把它带到屋顶上！

你们俩在设备的重量下吃力地搬运。追兵的声音越来越大，他们的脚步声在墙壁上回荡。你们气喘吁吁、满头大汗地到达了屋顶。

**莱昂纳多**：帮我设置它！

你们一起工作，手法娴熟精确。你们俩都爬上了装置，心脏在胸腔里剧烈跳动。

**莱昂纳多**：抓紧了！

随着最后一推，空中螺旋桨开始旋转。螺旋桨叶片抓住了空气，你感到一阵突然的升力。当装置起飞，在罗马屋顶上方飞翔时，地面在你们脚下远去。

**你**：我们做到了，莱昂纳多！我们在飞！

**莱昂纳多**：是的，但我们需要找一个安全的地方降落。

你俯瞰这座城市；古老的建筑在你们下方延伸开来。

<div>
  <img src="../assets/airborne.png" alt="空中飞行，脚悬空俯瞰城市" width="300">
</div>

## 与斯福尔扎互动

如果你想与斯福尔扎互动，请运行 [Characters](/app/README.md) 应用程序。

> [!IMPORTANT]
> 这完全是虚构的；这些回应是由 AI 生成的。
> [负责任的 AI 免责声明](../../../README.md#responsible-ai-disclaimer)

<div >
  <img  src="../assets/ludovico.png" alt="卢多维科·斯福尔扎" width="300" >
</div>

**步骤**：

1. 启动一个 [![GitHub Codespace](https://img.shields.io/badge/GitHub-Codespace-brightgreen)](https://codespaces.new/microsoft/generative-ai-with-javascript)
2. 导航到仓库根目录中的 _/app_。
3. 在控制台中运行 `npm install` 然后运行 `npm start`。
4. 当它出现时，选择"在浏览器中打开"按钮。
5. 与斯福尔扎聊天。

有关应用程序的更详细解释，请参见[详细应用程序说明](../../01-intro-to-genai/README.md#talk-to-dinocrates)。

> [!NOTE]
 > 如果你在本地机器上运行项目，请查看快速入门指南以设置 [GitHub personal access](../../../docs/setup/README.md#creating-a-personal-access-token-pat-for-github-model-access) token 并在代码中替换密钥。

## 什么是提示工程？

**时间甲虫**：我们需要谈谈提示工程。

**你**：是吗？那是什么？

**时间甲虫**：提示工程尽管其名称如此，但它不是关于建造桥梁或道路，而是关于精心制作正确的"提示"，以便从生成式 AI 语言模型中获得所需的输出。

**你**：好的，但为什么我需要知道这个？

**时间甲虫**：嗯，你想让空中螺旋桨安全降落，对吧？

**你**：是的，最好是完好无损地降落。:-)

**时间甲虫**：我想也是，现在请听好！提示工程是关于精心制作正确的提示，以便从语言模型中获得所需的输出。

**时间甲虫**：大型语言模型具有所谓的_涌现特性_，这意味着这些特性并非明确编程到模型中，而是源自它在大量文本数据上的训练方式。通过研究这些涌现特性，你可以得出结论并发现模式，这些可以帮助你从模型中获得更好的结果。

**你**：好的，所以有一些我们发现的模式可以帮助我们从模型中获得更好的结果。但这如何帮助我降落空中螺旋桨呢？

**时间甲虫**：是的，没错，哇，你真的不太有耐心，是吧？

**你**：嗯，如果你正在一个没有明确降落说明的装置上飞行，你也不会有耐心。

**时间甲虫**：我就在这里陪着你，你知道的，但让我们回到重点上。

## 提示工程如何帮助应用程序开发者

**时间甲虫**：作为从业者，能够精心制作更好的提示是你工具箱中应该拥有的一项技能。

从开发者的角度来看，你可以使用提示工程来：

- **获得更准确的结果**，从你的语言模型中，并最终改善应用程序的用户体验。

- **控制模型的输出**，确保它对你的用户来说是相关且适当的。这在处理敏感话题时尤为重要，也是保护你的品牌声誉的重要方式。

- **格式化输出**，使其易于理解和使用。我们将在下一章深入探讨这一方面。

**时间甲虫**：让我们来探索你可以用来为语言模型制作有效提示的不同技术和策略。

## 提示工程技术和策略

**时间甲虫**：以下是你可以用来制作有效提示的一些技术和策略：

- **少样本提示（Few-shot prompting）**。这种技术涉及给 AI 几个例子，展示你想要的回应类型。

- **思维链提示（Chain-of-thought prompting）**。这种技术涉及提供一系列提示，教 AI 如何一步步解决复杂任务。

- **元提示（Meta-prompts）**。这种技术涉及添加额外的细节或指令，以更精确地塑造 AI 的输出。

- **助产式提示（Maieutic prompting）**。这种技术涉及使用引导性问题，引导 AI 朝特定答案方向发展。

**你**：这听起来很有趣，我猜你会给我一些例子？

**时间甲虫**：是的，马上来。让我们看看每种技术的例子，以便我们了解它们在实践中如何工作。

### 少样本提示：提供例子引导 AI 输出

少样本提示给 AI 模型提供几个例子来引导其输出。想象你正在空中螺旋桨上询问关于古罗马的问题。少样本提示可能如下所示：

> "告诉我关于罗马斗兽场的信息。" → "它是一个巨大的圆形剧场。"
>
> "古罗马的生活是怎样的？" → "它繁忙且艰难。"

**你**：我明白了！这有助于 AI 正确理解，即使在这么高的地方！;)

**时间甲虫**：没错，这是一种可靠的方法。接下来！

### 思维链提示：展示一步步推理

**时间甲虫**：这种技术通过展示一步步的推理过程来引导 AI 解决问题。想象要降落空中螺旋桨。你可以这样分解问题：
- 你在100米高空。
- 重力以 9.8 m/s² 拉力。
- 公式：高度 = ½ * g * t²。
- 解算：t ≈ 4.5秒完成降落。

你的提示变成：
> - 距地面100米高  
> - 重力：9.8 m/s²  
> - 需要多少秒才能着陆？  

**答案：4.5秒**

**你**：那很快——希望数字计算准确！

**时间甲虫**：它教会 AI 一步步思考。

**你**：所以是关于分解问题以获得精确答案？

**时间甲虫**：是的，非常适合复杂任务，比如数学辅导应用！

### 助产式提示：提问输出以验证准确性

**时间甲虫**：这种技术使用问题来检查 AI 输出的准确性。你对每一步提出问题，以确保推理的一致性。

**你**：所以，质疑它说的每一句话？听起来很有趣。;)  

**时间甲虫**：我们来测试空中螺旋桨降落：
- 高度100米
- 重力：9.8 m/s²
- 需要多少秒才能着陆？（答案：4.5秒）

问："为什么是4.5秒？"

> **回答**：
> - 高度 = 100米，初始垂直速度 = 0 m/s，重力 = 9.8 m/s²。 
> - 使用公式：高度 = ½ * g * t²。
> - 解算：100 = ½ * 9.8 * t² → t ≈ 4.5秒。

**时间甲虫**：这是关于通过后续问题验证 AI 的答案。

**你**：所以，不要信任它——而是用问题来探究它？

**时间甲虫**：没错！确保推理是可靠的。

## 元提示：添加额外指令以提高精确度

**时间甲虫**：接下来是元提示。

**你**：呃，先喝茶？

**时间甲虫**：_叹气_。它们为提示添加指导以获得更好的输出——非常适合敏感、面向客户的应用。

这是一个例子：
> **元提示**： 仅使用 Contoso 公司产品（篮球、足球、网球拍）。保持准确性和用户友好性。
> **提示**： 适合初学者的最佳体育产品是什么？
> **回答**： 篮球、足球和网球拍——非常适合协调性和敏捷性训练。

它确保准确性并坚持使用 Contoso 的产品。如果没有元提示：
> **提示**： 适合初学者的最佳体育产品是什么？
> **回答**： 篮球、足球、网球拍，还有橄榄球——_不全是 Contoso 产品_。

**你**：很方便！保持回答在轨道上，就像我自动机的法则一样。

**时间甲虫**：你会知道的，_"弗兰肯斯坦"_——呃，没什么！

**你**：什么？

**时间甲虫**：没什么。

> 玛丽·雪莱的《弗兰肯斯坦》——1818年，比你的时间旅行早42年。[了解更多](https://en.wikipedia.org/wiki/Mary_Shelley)

**你**：所以，没有元提示就意味着混乱？

**时间甲虫**：是的，你会得到偏离品牌的答案。

**你**：明白了，精准很重要！

## 作业 - 帮助我们的英雄降落空中螺旋桨

**你**：这是你向我展示如何降落空中螺旋桨的部分，对吧？

**时间甲虫**：是的，让我们开始吧。山丘大约距离我们当前位置100米远。以下是我们如何设置提示：

- 当前距地面高度：100米
- 向前移动速度：每秒10米
- 重力：每秒平方9.8米
- 向上风力：每秒0.7米

**莱昂纳多**：你的 AI 装置能否帮助计算，看看我们是否能够成功降落，或者我们是否需要再次进行时间跳跃？

**时间甲虫**：我可以的，不过我的名字是乔治（George），我更喜欢这个名字而不是"装置"。实际上，我打算让你们两个自己弄清楚如何设置提示。☺️

构建一个应用程序，询问：

- 高度
- 前进速度
- 重力
- 向上风力
- 到山丘的距离

使用思维链技术得出回应。

这里有一个入门项目 [入门项目](/app/README.md)。

## 解决方案

用 JavaScript 构建一个应用程序，询问以下输入：

- 当前距地面高度
- 每秒前进速度（米）
- 每秒平方米的重力
- 每秒米的向上风力
- 到山丘的距离

然后使用 LLM 整合这些输入，并利用思维链提示技术引导模型得出正确答案。

[解决方案](/lessons/01-intro-to-genai/solution/solution.md) 

## 知识检验

**问题**： 什么是提示工程？选择所有适用项。

A. 提示工程是关于建造桥梁和道路。

B. 提示工程是关于精心制作正确的提示，以便从语言模型中获得所需的输出。

C. 提示工程是关于训练模型识别数据中的模式。

[测验解答](/lessons/01-intro-to-genai/solution/solution-quiz.md)

## 自学资源

- [提示工程](https://en.wikipedia.org/wiki/Prompt_engineering)
- [提示工程基础](https://github.com/microsoft/generative-ai-for-beginners/blob/main/04-prompt-engineering-fundamentals/README.md?WT.mc_id=academic-105485-koreyst)
- [高级提示工程](https://github.com/microsoft/generative-ai-for-beginners/tree/main/05-advanced-prompts)
